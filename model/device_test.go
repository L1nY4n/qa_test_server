package model_test

import (
	"bytes"
	"encoding/binary"
	"fmt"
	"qa_test_server/model"
	"strconv"
	"strings"
	"testing"
)

func TestDecode(t *testing.T) {

	str := "104 101 108 108 111 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 170 85 85 76 45 71 78 45 48 48 54 48 0 0 0 0 0 0 0 0 0 0 50 50 48 54 78 49 49 48 48 48 48 55 0 0 0 0 0 0 0 0 51 49 48 50 48 48 48 49 0 0 0 0 0 0 0 0 0 0 0 0 3 0 0 0 0 97 0 100 101 98 117 103 0 0 0 0 0 0 0 0 105 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 91 4 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 37 1 22 7 5 16 42 40 0 0 0 0 0 0 0 0 0 0 0 0 0 2 0 208 7 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 184 11 0 1 0 0 0 0 0 0 0 0 102 102 6 64 102 102 6 64 102 102 6 64 154 153 153 62 205 204 12 64 0 0 0 64 0 0 0 0 0 0 0 0 0 128 20 67 0 0 160 65 0 0 160 65 0 0 0 0 10 215 163 61 10 215 163 61 10 215 163 61 0 0 32 66 0 0 20 66 0 0 20 66 0 0 16 65 0 0 16 65 0 0 16 65 0 0 0 0 0 0 0 0 252 228 48 66 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 12 68 0 0 27 68 51 51 131 64 0 0 0 0 0 0 0 0 0 0 0 0 51 51 51 64 51 51 51 64 0 0 192 64 0 0 192 64 0 0 208 65 0 0 208 65 0 0 208 65 0 0 208 65 0 0 0 0 0 0 0 0 0 0 0 192 0 0 0 192 0 0 32 193 0 0 32 193 0 0 32 193 0 0 32 193 0 0 32 193 0 0 32 193 0 0 0 0 0 0 0 0 154 153 201 64 0 0 208 64 154 153 217 64 0 0 224 64 154 153 233 64 0 0 240 64 0 0 240 64 0 0 240 64 0 0 240 64 0 0 240 64 0 0 240 64 0 0 0 0 102 102 134 64 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 128 63 0 0 0 0 0 0 0 0 0 0 240 65 0 0 224 65 0 0 224 65 0 0 240 65 0 0 240 65 0 0 240 65 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 112 65 0 0 176 65 0 0 176 65 0 0 144 65 0 0 144 65 0 0 144 65 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 101 114 124 132 140 146 156 166 185 240 29 39 46 56 63 68 76 83 90 98 30 41 47 59 64 73 79 86 95 103 32 42 52 61 68 78 84 95 100 110 32 44 54 63 73 73 79 98 106 117 34 46 57 66 74 83 91 101 110 122 34 47 57 68 78 86 96 106 115 127 34 47 57 68 78 86 90 103 117 125 34 49 59 69 79 88 98 108 117 127 34 49 59 69 79 88 98 108 117 127 34 49 59 69 79 88 98 108 117 127 34 49 59 69 79 88 98 108 117 127 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 255 255 255 255 255 127 230 255 45 134 170 255 2 0 1 1 1 1 1 1 0 0 1 15 207 9 68 64 194 19 68 255 207 119 64 0 0 0 0 0 88 228 64 254 47 230 64 0 0 0 0 0 0 0 0 0 0 240 64 0 0 0 0 0 0 0 0 19 107 64 65 102 202 63 193 73 99 168 64 0 0 0 0 12 2 190 65 12 2 190 65 0 0 0 0 0 0 0 0 102 48 81 64 205 8 81 64 153 57 159 63 0 110 26 64 153 199 24 64 0 43 63 65 21 202 190 65 252 228 203 65 189 70 215 65 0 0 0 0 0 0 0 0 61 10 203 65 205 237 222 65 0 0 0 0 127 222 214 65 197 141 212 65 0 0 0 0 0 0 0 0 10 31 199 65 102 102 226 65 205 204 44 65 205 204 204 189 1 0 128 20 67 0 128 20 67 0 0 0 0 0 0 0 0 10 215 163 61 0 0 32 66 0 0 0 0 255 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 2 0 208 7 0 0 208 7 237 46 184 11 236 81 216 65 61 10 203 65 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 6 163 130 64 82 184 236 64 0 0 112 67 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 40 0 0 0 0 0 22 7 7 17 22 59 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0"
	list := strings.Split(str, " ")
	buffer := make([]byte, len(list))
	for i, v := range list {
		b, _ := strconv.Atoi(v)
		buffer[i] = byte(b)
	}

	var temp model.Femto_msg_packed
	binary.Read(bytes.NewReader(buffer[:]), binary.LittleEndian, &temp)
	fmt.Printf("Dev_cap= %+v\n", temp)

	device := model.Femto_Decode(temp)
	fmt.Printf("dev %+v\n", device)
}

//Dev_cap= {Cap_info:{Time:1657185712 Name:[104 101 108 108 111 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0] Bate:[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]} Sys_para:{HeadA:170 HeadB:85 Pro_info:{Model:[85 76 45 71 78 45 48 48 54 48 0 0 0 0 0 0 0 0 0 0] SN:[50 50 48 54 78 49 49 48 48 48 48 55 0 0 0 0 0 0 0 0] PN:[51 49 48 50 48 48 48 49 0 0 0 0 0 0 0 0 0 0 0 0] Hardware_bate:[3 0 0 0 0] Optics_bate:[97 0 100 101 98 117 103 0 0 0 0 0 0 0 0] Mcu_vision:[105 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0] Fpga_vision:[1115 0 0 0 0 0 0 0 0 0] Storage_cnt:293 Record_time:{Year:22 Month:7 Day:5 Hour:16 Miunte:42 Second:40} Activation_time:{Year:0 Month:0 Day:0 Hour:0 Miunte:0 Second:0} Deadline_time:{Year:0 Month:0 Day:0 Hour:0 Miunte:0 Second:0}} Seed_param:{Seed_board_type:0 Width:2 Freq:2000 Burst_number:0 Burst_interval:0 Burst_wareform:[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0] Para_reserved:[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0] Power_level:3000 Trigger_mode:0} Sys_cc:{IsLock:1 Unlock_time:0 Fiber_alarm_cnt:0 Res1:0 IsActive:0 IsOverdue:0 IsOverdue_op:0 IsFactory:0} Pd_param:{Freq_ref:[2.1 2.1 2.1] Protect_ref:[0.3 2.2 2]} Temp:{Ld_temp:[0 0] Tcm_temp:[148.5 20 20] Seed_temp:0} Tcm:{Tcm_control_p:[0.08 0.08 0.08] Tcm_control_i:[40 37 37] Tcm_control_d:[9 9 9] Pid:{En:0 Set:0 Actual:44.223618 Err:0 Err_last:0 Kp:0 Ki:0 Kd:0 Kout:0 Voltage:0 Integral:0 Limit_max:0 Limit_min:0}} Cur:{Seed_cur:0 Single_cur:[560 620] Ap_cur:4.1 Ap_thr_h:0 Ap_thr_l:0 Apm_max_cur:0} Mon_limit:{Vol_limit_max:[2.8 2.8 6 6 26 26 26 26 0 0] Vol_limit_min:[-2 -2 -10 -10 -10 -10 -10 -10 0 0] Cur_limit_max:[6.3 6.5 6.8 7 7.3 7.5 7.5 7.5 7.5 7.5 7.5 0 4.2 0 0] Cur_limit_min:[0 0 0 0 0 0 0 0 0 0 0 0 1 0 0] Temp_limit_max:[30 28 28 30 30 30 0 0 0 0] Temp_limit_min:[15 22 22 18 18 18 0 0 0 0] Fpga_thr:[101 114 124 132 140 146 156 166 185 240 29 39 46 56 63 68 76 83 90 98 30 41 47 59 64 73 79 86 95 103 32 42 52 61 68 78 84 95 100 110 32 44 54 63 73 73 79 98 106 117 34 46 57 66 74 83 91 101 110 122 34 47 57 68 78 86 96 106 115 127 34 47 57 68 78 86 90 103 117 125 34 49 59 69 79 88 98 108 117 127 34 49 59 69 79 88 98 108 117 127 34 49 59 69 79 88 98 108 117 127 34 49 59 69 79 88 98 108 117 127 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0] Alarm_mask:18439566461803429887} CRCH:45 CRCL:134} Sys_mon:{HeadA:170 HeadB:255 Mon_laser:{Laser_mode:2 Laser_status:0 Seed_on:1 Ld1_on:1 Ld2_on:1 Fpga_ap_on:1 Fpga_apm1_on:1 Fpga_apm2_on:1 Fpga_apm3_on:0 Fpga_apm4_on:0 Fpga_aom_on:1} Mon_cur:{Ld_1cur:551.2353 Ld_2cur:591.03516 Pre1_cur:3.87207 Pre2_cur:0 Main1_cur:7.135742 Main2_cur:7.1933584 Main3_cur:0 Main4_cur:0 Main_cur_limit:7.5 Seed_cur:0 Tcm_cur:0} Mon_vol:{Vp12_vol:12.026141 Vn12_vol:-11.986914 Pre1_vol:5.26212 Pre2_vol:0 Main1_vol:23.751 Main2_vol:23.751 Main3_vol:0 Main4_vol:0 N3v3_vol:3.268579 F3v3_vol:3.2661622 F1v25_vol:1.2439452 Ld1_vol:2.4129639 Ld2_vol:2.3871825 Vcc12:11.947998 Vcc24:23.848673} Mon_temp:{Ld1_temp:25.486809 Ld2_temp:26.90954 Tcm_temp:0 Tcm_module_temp:0 Seed_temp:25.38 Pre1_temp:27.866114 Pre2_temp:0 Main1_temp:26.85864 Main2_temp:26.569223 Main3_temp:0 Main4_temp:0 Plate_temp:24.890156 Hdc_temp:28.3 Hdc_humi:10.8 Hdc_dew_point:-0.1} Mon_tcm:[{SW:1 Actual_temp:148.5 Adjust_temp:148.5 Rms:0 Senser_type:0 Control_p:0.08 Control_i:40 Control_d:0 Alarm:255 TCM_Ready:0} {SW:0 Actual_temp:0 Adjust_temp:0 Rms:0 Senser_type:0 Control_p:0 Control_i:0 Control_d:0 Alarm:0 TCM_Ready:0} {SW:0 Actual_temp:0 Adjust_temp:0 Rms:0 Senser_type:0 Control_p:0 Control_i:0 Control_d:0 Alarm:0 TCM_Ready:0}] Mon_seed:{Enable:1 Alarm:0 Trig_mode:0 Pulse_width:2 Pulse_freq:2000 Select_freq:0 Fpga_read_freq:2000 Supply_vol:12013 Power:3000 Mudule_temp:27.04 Seed_ld_temp:25.38 Para_reserved:[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]} Mon_alarm:{Alarm_flag_reg_now:0 Alarm_flag_reg_active:0 Alarm_flag_reg_history:0} Mon_fpga:{Pre_cur_set:4.0824003 Main_cur_set:7.3975 Aom_vol_set:240 Ap_freq:0 Ap_duty:0 Apm_freq:0 Apm_duty:0 Aom_freq:0 Aom_duty:0 Fpga_apm_pwm_sw:0 Fpga_aom_delay:40 Ext_io_status:0 Ext_power_level_bit:0} Mon_time:{Year:22 Month:7 Day:7 Hour:17 Miunte:22 Second:59}}}
